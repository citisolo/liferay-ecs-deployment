# AWS ECS Deployment and Infrastructure Setup Guide

This guide outlines the steps to set up and deploy an application on AWS ECS using Terraform and GitHub Actions. The process involves creating a dedicated AWS user for deployments, configuring your GitHub repository with the necessary secrets for AWS access, setting up the infrastructure using Terraform, and finally, deploying your application through a GitHub Actions workflow triggered by pushes to the `staging` branch.

## Step 1: Create a User on AWS

1. **Prepare the IAM User Creation Script**: Ensure you have the script ready that automates the creation of an AWS IAM user with the necessary permissions for managing ECS deployments and Terraform infrastructure changes. This script should also create access keys for the new user.

2. **Run the Script**: Execute the script in your terminal. It will output the Access Key ID and Secret Access Key for the newly created user. Make sure to store these credentials securely as they will be needed for the next steps.

    ```bash
    ./create_aws_user.sh <username>
    ```

    Replace `<username>` with your desired IAM username.

## Step 2: Configure GitHub Repository Secrets

1. **Navigate to Your GitHub Repository Settings**: Go to the `Settings` tab of your GitHub repository, then find the `Secrets` section.

2. **Add AWS Credentials as Secrets**: Click on `New repository secret` and add the following secrets:

    - `AWS_ACCESS_KEY_ID`: The Access Key ID generated by the script.
    - `AWS_SECRET_ACCESS_KEY`: The Secret Access Key generated by the script.

    These secrets will be used by GitHub Actions to authenticate with AWS.

## Step 3: Set Up Infrastructure Manually with Terraform

1. **Initialize Terraform**: Navigate to your Terraform configuration directory and run:

    ```bash
    terraform init
    ```

2. **Apply Terraform Configuration**: To set up your AWS infrastructure (e.g., VPC, ECS cluster, etc.), run:

    ```bash
    terraform apply
    ```

    Review the proposed changes and confirm the operation. Ensure your AWS credentials are configured properly in your environment or via Terraform variables.

## Step 4: Push to the 'Staging' Branch

1. **Make Changes**: Apply your application or infrastructure changes as needed.

2. **Push to Staging**: Commit your changes and push them to the `staging` branch of your GitHub repository.

    ```bash
    git checkout -b staging
    git add .
    git commit -m "Your commit message"
    git push origin staging
    ```

3. **Observe GitHub Actions Workflow**: The push to the `staging` branch will trigger the GitHub Actions workflow for deployment. Monitor the Actions tab in your GitHub repository to see the progress and outcome of the deployment.

4. **Sync to Main (Optional)**: If the deployment is successful and you've set up automatic syncing in your workflow, changes will be merged into the `main` branch. Otherwise, manually review and merge the changes to keep your branches in sync.

## Conclusion

By following these steps, you have set up an automated deployment pipeline using GitHub Actions for AWS ECS, managed your infrastructure as code with Terraform, and ensured best practices for security by creating a dedicated AWS IAM user for your CI/CD processes.
